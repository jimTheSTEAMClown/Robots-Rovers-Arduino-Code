// I2C Target - Receive 2 Bytes Lab#2
// Reseiving 2 Bytes that are 0-255 and Random to turn on or off 
// 2 LEDs on the Target Arduino
// I2C Target - Lab#2
#include <Wire.h>

#define TARGET_ADDR 0x08
#define LED1_PIN 8
#define LED2_PIN 9

byte i2c_byte_data1 = 0; // 0 to 255
byte i2c_byte_data2 = 0; // 0 to 255

volatile byte led1State = 0;
volatile byte led2State = 0;

void setup() {
  Serial.begin(115200);
  pinMode(LED1_PIN, OUTPUT);
  pinMode(LED2_PIN, OUTPUT);

  Wire.begin(TARGET_ADDR);      // Join I2C bus as Target
  Wire.onReceive(onReceiveEvent);
  
  Serial.println(TARGET_ADDR);
}

void loop() {
  Serial.print("Value 1: ");
  Serial.println(i2c_byte_data1);
  Serial.print("Value 2: ");
  Serial.println(i2c_byte_data2);
  if(i2c_byte_data1 > 127){
  digitalWrite(LED1_PIN, HIGH);
  //delay(200);
  }else{
    digitalWrite(LED1_PIN, LOW);    
  }
  if(i2c_byte_data2 > 127){
  digitalWrite(LED2_PIN, HIGH);
  //delay(200);
  }else{
    digitalWrite(LED2_PIN, LOW);    
  }
  delay(800);
}

void onReceiveEvent(int bytesReceived) {
  if (bytesReceived >= 2) {
    //Serial.println("got 2 bytes");
    i2c_byte_data1 = Wire.read();
    i2c_byte_data2 = Wire.read();
  }
}

/*

// I2C Controller - Pass 2 Bytes Lab#1
// Passing 2 Bytes that are 0-255 and Random to turn on or off 
// 2 LEDs on the Target Arduino
// Controller Code
#include <Wire.h>

#define TARGET_ADDR 0x08

byte i2c_byte_data1 = 77;
byte i2c_byte_data2 = 255;

void setup() {
  //Serial.begin(115200);
  Wire.begin();  // Join I2C bus as Controller
  randomSeed(analogRead(0));
}

void loop() {
  Wire.beginTransmission(TARGET_ADDR);
  Wire.write(i2c_byte_data1);
  Wire.write(i2c_byte_data2);
  Wire.endTransmission();

  // Toggle LED states
  i2c_byte_data1 = random(0, 256);
  //Serial.println(i2c_byte_data1);
  i2c_byte_data2 = random(0, 256);
  //Serial.println(i2c_byte_data2);
  
  delay(1000);
}

*/
